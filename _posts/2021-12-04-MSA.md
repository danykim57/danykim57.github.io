---
title:  "MSA 아키텍쳐"
header:
  teaser: "https://farm5.staticflickr.com/4076/4940499208_b79b77fb0a_z.jpg"
categories: 
  - BackEnd
tags:
  - 설계
---
   
   마이크로서비스 아키텍쳐(Microservice Architecture)는 대형 IT회사들이 쓰는 주된 앱 설계 중 하나이다.
   
   MSA에 대해서 설명하기 전 당시 개발자들이 어떠한 문제점을 가졌는지 알아보자.
   
   분산시스템, AWS, 구글 클라우드, 마이크로소프트 Azure와 같은 대형 인프라 시스템들의 문제점은 설치만으로 
   
   끝나는 것이 아니라 소프트웨어와 하드웨어적 장애가 발생을 한다는 것이다.
   
   대략 20% 정도는 하드웨어 장치의 수명이나 물리적 장애로 발생을 하고 나머지 80%는 소프트웨어적인 문제이다.
   
   이 소프트웨어적인 문제에서 대부분을 차지하는 것이 개발과 운영 인력에 의한 장애이다.
   
   결국 절반 이상의 문제들이 개발자와 시스템 운영자들에 의해서 일어나는데
   
   개발자들이 이런 부분을 최소화 시키기 위해서 선택한 업무 방식을 테스트 중심의 개발 이라고 한다(Test-Driven Development).
   
   이 TDD의 특징은 가장 작은 함수 부터 시스템 통합 테스트(Integration test)까지 모든 것을 테스트 예제를 
   
   먼저 생가가고 실제 구현 코드를 짜서 코드의 부작용들을 최소화시키면서 코드의 사이즈가 방대해져도 만들어둔 테스트 코드들을
   
   돌려서 코드 구현의 성공여부를 판가름 내는 것이다.
   
   즉, 개발자들이 구현 코드만 만들면 자기가 뭘 썼는지도 기억이 안나는 경우가 나오고 디버깅에 90% 이상의 시간을 소요하는 사태가
   
   너무나도 많이 발생해서 이 디버깅 시간을 줄이기 위해서 만든 업무 프로세스이다.
   
   
   
   여기서 중요한 개념이 디커플링(decoupling)이다.
   
   붙어있는 두가지를 떼어낸다는 뜻을 거진 디커플링은 테스트와 구현을 서로 떼어냄으로서 업무를 단순화시켰다.
   
   이것은 옥스포트 대학교에서 유명한 글쓰기 수업의 요지와 일맥상통한데
   
   이 수업에서 교수들은 학생이 글을 쓰는 시간과 글을 비판적으로 교정하는 시간을 반드시 나누라고 강조한다.
   
   창조적인 행동과 파괴적인 행동을 나누어서 하여야 제대로된 효율이 나온다는 의미이다.
   
   
   MSA는 기존의 모노리틱(monolithic) 설계 방식에서의 문제점을 디커플링한 설계이다.
   
   기존의 모노리틱 설계 방식은 개발자가 사업에서 제공하는 모든 서비스들을 한 코드 덩어리에 넣어두었다.
   
   모노리틱 설계의 이 문제점을 해결하기 위해서 MVC(Model View Control)과 같이 서비스 코드들을
   
   그 기능에 따라서 분리하였지만 너무나도 다양한 서비스들을 제공하게된 상태에서
   
   서비스들을 아예 서로 필요한 데이터는 주고 받을 수 있지만 한 쪽의 문제가 다른 쪽으로 넘어가는 것을
   
   예방하기 위해 만든 설계이다.
   
   
   이것은 셰계적인 투자자인 조지 소로스가 2008년 서브 프라임 모기지 사태가 일어난 이유를 설명한 부분과
   
   굉장히 비슷한데 자세한 내용은 아래에 링크를 걸어 두겠다.
   
   http://m.weekly.khan.co.kr/view.html?med_id=weekly&artid=201109201655071&code=
   
   MSA의 요지 중 하나는 유조선의 칸막이와 같이 필요한 만큼 안전 장치를 달아서 서비스를 정상적으로
   
   관리 유지할 수 있도록 하는 것에 있다.
   
   
   
   그렇다면 그냥 많은 모노리틱 앱들을 묶은 것이 MSA가 아닌가?
   
   맞기도 하고 아니기도 하다.
   
   일단 분산시스템에서 요구하는 CAP 이론에 따르면 가능한한 데이터베이스들이 현 시간대에 정확한
   
   데이터값을 가지고 있어야 한다.
   
   많은 서비스들이 이리저리 데이터를 주고 받다보면 결국 각각의 앱들이 데이터베이스를 따로 가지고 있더라도
   
   공통된 데이터에서 데이터베이스의 일관성에 문제를 일으키게 된다.
   
   또는 분산 시스템에서 성능을 위해서 데이터 베이스를 쪼개어서 보관하는 형태를 가지고 있는데 
   
   이 경우에도 데이터베이스의 일관성과 무결성에 문제가 생긴다.
   
   같은 유저가 다른 디바이스들에서 다른 정보를 볼 수 있다던가 다른 유저가 다른 정보를 보는
   
   문제나 데이터의 무결성이 위배되는 등 모노리틱 설계에서 쓰인 데이터베이스 중심의 설계는
   
   MSA에서는 유효하지 않다.
   
   
   
   주 해결책은, MSA에서 데이터 처리의 핵심은 중점을 데이터베이스에 두는 것이 아닌 실제로 서비스들 사이에서
   
   흐르는 데이터들의 대기열인 메시지 큐잉(Message Queueing)에 두는 것 이다. 
   
   대표적인 기술로는 오픈 소스의 아파치 카프카와 래빗 엠큐가 있다.
   
   이런 메시지 큐잉 기술들은 서비스들간에 들어온 요청들을 순서대로 동기화 시켜서 데이터베이스에 반영을
   
   해주는 역할을 한다.
   
   
   결국 다량의 데이터들이 왕복하게 되면서 성능을 위해서 이 통신에 쓰이는 데이터 패킷들의 용량을
   
   줄이는 것에 개발자들이 고민을 하였는데 그 중 한가지가 RESTful api이다.
   
   이건 다음 포스트에서 다루도록 하겠다.
   
   
 
