---
title:  "오픈 데이터베이스와 방화벽의 중요성"
header:
teaser: "https://farm5.staticflickr.com/4076/4940499208_b79b77fb0a_z.jpg"
categories:
  - 잡설
tags:
  - 잡설
---
  
  대학교 시절에 블리자드 게임인 오버워치를 열심히 하였던 때가 있었다.

랭크 게임을 매일 같이 열심히 돌리면서 꿈에 그리는 Top 500을 향해서 달려가고 있을 때

팀원간의 의사소통의 중요성을 깨달으면서 오버워치 VoIP가 제공하는 인게임 음성채팅을

활용하려는 시기에 음성채팅 기능이 작동하지 않는 다는 것을 찾아내었다.

  이유는 간단했다. 게임 설치를 할 때 인스톨러가 자동적으로 윈도우 방화벽에 게임 서비스가

사용하는 포트를 열어주지만 대학교가 ISP(인터넷 공급자)로서 방화벽을 운영하고 있어서

오버워치 VoIP UDP 포트가 막혀있었다.

  학교 인터넷 보안 측에 연락을 하여서 포트를 열어 줄 수 없냐고 물었지만 보안상의

이유로 거절을 당했다.

  이 사건을 계기로 포트와 보안간의 관계를 알게 되었다.

  웹앱 강의들을 보다보면 강의자가 편의상의 이유로 Public IP 인터페이스를

공개해버리는 경우를 자주 볼 수 있다.(IP 허가를 0.0.0.0로 하여서 어떤 IP로든 접근이 가능하게 하는 경우)

Docker나 쿠버네티스를 사용할 때 p 127.0.0.1:8080:8030 이런식으로 커맨드 끝에 붙이는 것 보다

p 8080:8030이 편하기 때문에 하는 행위인데 이걸 확실하게 인지하고 고치면 다행이지만

뭐든 까먹는게 사람이 아니던가. 그냥 열어두고 방치되는 경우가 많다.

밑의 첫 출처의 저자인 Avi는 단순히 파이썬, MasScan(비동기로 패킷을 던져서 포트 이용가능 여부를 알 수 있는 포트스캐너), ELK 스택, CIDR 블럭(일반적으로 사용하는 IP 번호들)을 이용해서

AWS와 같은 클라우드 서비스에서 33만개가 넘게 열려있는 포트를 찾을 수 있었고

이 중 꽤나 많은 숫자가 인증없이도 접근 및 수정이 가능하였다고 한다.

그 중 많은 데이터베이스는 이미 랜섬웨어에 감염되어있었다.

최근 Docker와 쿠버네티스를 이용하면서 편하다고 느꼈던 것이 AWS EC2를 사용하였을 때 네트워크 보안 설정을

수동으로 매번 고쳐주는 것이 불편했는데 이 두가지 툴을 같이 이용할 때 기본 보안설정 값으로

간단하게 앱 배포가 가능하다는 부분이였다.

  한 편으로 생각하던 것이 이게 정말로 안전한가? 였다.

그리고 실제로 Docker의 몇몇 커맨드와 ElasticSearch의 기능들은 안전하지 않다.

예를 들어서 Docker의 copy 커맨드의 기능 중 하나가 Linux의 방화벽인 UFW를 뚫고 네트워크를 형성시키는 것인데

만약에 Docker의 사용자가 이 부분을 간과하고 계속 프로젝트를 진행하다가

잊어먹고 포트를 닫지 않거나 최소한의 인증절차도 만들어 놓지 않는다면

데이타 브리치가 일어나면서 회사가 법적인 문제에 휘말릴 가능성이 굉장히 농후하다. 

회사의 향후 방침에 대한 기밀정보가 노출되면서 내부자 갈등(회사 외부 인물이 회사 내부의 기밀로 사적 이익을 얻는 경우)이

일어날수도 있고 엄청난 돈을 들여서 만든 데이터가 통째로 날아갈 수도 있다.

  쿠버네티스를 공부하면서 느끼는 것이 툴 자체가 막대한 권한을 가지면서 결과물을 빠르게
  
보여줄 수 있다는 것이 좋지만 너무 중간 과정이 생략이 되어서 운영체제, 네트워크, 보안

부분을 잘 이해하지 못한 사람이 이용하면 의도치 않는 실수들이 너무 많이 발생하면서

그 문제의 크기가 너무나 커질 수 있다는 점이다.



결론: 최소한 JWT나 다른 인증시스템을 적용시키고 p 8080:8030 하지말고 IP도 좀 같이 쓰자.

p 127.0.0.1 숫자 아홉개 추가로 쓰는 걸로 많은 것을 예방할 수 있다.



출처:

[Open Databases on aws](https://infosecwriteups.com/how-i-discovered-thousands-of-open-databases-on-aws-764729aa7f32)
[Blizzard OW Voip port](https://portforward.com/overwatch-nat-type-open/)
[MasScan Github](https://github.com/robertdavidgraham/masscan)
[HackerNews comment section](https://news.ycombinator.com/item?id=30144021)